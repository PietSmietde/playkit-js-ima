{"version":3,"sources":["webpack:///ima/webpack/universalModuleDefinition","webpack:///ima/webpack/bootstrap a5b85016c5944be87979","webpack:///ima/external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":\"Playkit\"}","webpack:///ima/./ima-middleware.js","webpack:///ima/./ima.js"],"names":["context","ImaMiddleware","pluginContext","next","initImaPromise","then","adsActive","resumeAd","pauseAd","pluginName","Ima","name","player","config","_adsManager","initComplete","_adsActive","_contentComplete","_contentPlayheadTracker","currentTime","previousTime","seeking","duration","_addBindings","_init","_adDisplayContainer","initialize","start","logger","debug","_resetIma","eventManager","destroy","resume","pause","listen","Event","LOADED_METADATA","_onLoadedMetadata","bind","TIME_UPDATE","_onMediaTimeUpdate","SEEKING","_onMediaSeeking","SEEKED","_onMediaSeeked","ENDED","_onMediaEnded","Promise","resolve","reject","loadPromise","window","google","ima","_loadIma","_sdk","_initAdsContainer","_initAdsLoader","_requestAds","adsContainerDiv","document","getElementById","videoElement","getVideoElement","parentNode","_adContainerDiv","appendChild","createElement","id","style","position","zIndex","top","AdDisplayContainer","_adsLoader","AdsLoader","addEventListener","AdsManagerLoadedEvent","Type","ADS_MANAGER_LOADED","_onAdsManagerLoaded","AdErrorEvent","AD_ERROR","_onAdError","adsRequest","AdsRequest","adTagUrl","adsResponse","error","requestAds","contentComplete","display","adsManagerLoadedEvent","adsRenderingSettings","AdsRenderingSettings","restoreCustomPlaybackStateOnAdBreakComplete","getAdsManager","_processAdsManager","AdEvent","CONTENT_PAUSE_REQUESTED","_onContentPauseRequested","CONTENT_RESUME_REQUESTED","_onContentResumeRequested","events","ALL_ADS_COMPLETED","CLICK","COMPLETE","FIRST_QUARTILE","LOADED","MIDPOINT","PAUSED","STARTED","THIRD_QUARTILE","index","_onAdEvent","playerElement","initWidth","parseInt","getComputedStyle","width","initHeight","height","init","ViewMode","NORMAL","adEvent","type","toUpperCase","_showAdsContainer","_hideAdsContainer","play","params","_onAllAdsComplete","_onAdClicked","_allAdsCompleted","r","t","getElementsByTagName","s","src","IMA_SDK_DEBUG_LIB_URL","IMA_SDK_LIB_URL","async","onload","onreadystatechange","readyState","onerror","onabort","insertBefore","defaultConfig","timeout","prerollTimeout","adLabel","showControlsForJSAds"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,+C;;;;;;;;;;;;;;;;;ACEA;;;;;;;AADA;;;AAGA,IAAIA,gBAAJ;;IAEqBC,a;;;AACnB,yBAAYC,aAAZ,EAAgC;AAAA;;AAAA;;AAE9BF,cAAUE,aAAV;AAF8B;AAG/B;;;;yBAEIC,I,EAAsB;AAAA;;AACzBH,cAAQI,cAAR,CAAuBC,IAAvB,CAA4B,YAAM;AAChC;AACA;AACA;AACE,YAAIL,QAAQM,SAAR,EAAJ,EAAyB;AACvBN,kBAAQO,QAAR;AACD,SAFD,MAEO;AACL,iIAAWJ,IAAX;AACD;AACH;AACD,OAVD;AAWD;;;0BAEKA,I,EAAsB;AAC1B,UAAIH,QAAQM,SAAR,EAAJ,EAAyB;AACvBN,gBAAQQ,OAAR;AACD,OAFD,MAEO;AACL,4HAAYL,IAAZ;AACD;AACF;;;;;;kBA1BkBF,a;;;;;;;;;;;ACJrB;;AACA;;;;;;;;;;;AAFA;;AAGA;;;AAGA,IAAMQ,aAAa,KAAnB;;IAEMC,G;;;;;8BA0Ba;AACf,aAAO,IAAP;AACD;;;AAED,eAAYC,IAAZ,EAA0BC,MAA1B,EAA0CC,MAA1C,EAA0D;AAAA;;AAAA,0GAClDF,IADkD,EAC5CC,MAD4C,EACpCC,MADoC;;AAExD,UAAKC,WAAL,GAAmB,IAAnB;AACA,UAAKC,YAAL,GAAoB,KAApB;AACA,UAAKC,UAAL,GAAkB,KAAlB;AACA,UAAKC,gBAAL,GAAwB,KAAxB;AACA,UAAKC,uBAAL,GAA+B;AAC7BC,mBAAa,CADgB;AAE7BC,oBAAc,CAFe;AAG7BC,eAAS,KAHoB;AAI7BC,gBAAU;AAJmB,KAA/B;AAMA,UAAKC,YAAL;AACA,UAAKC,KAAL;AAbwD;AAczD;;;;0CAE2C;AAC1C,aAAO,4BAAkB,IAAlB,CAAP;AACD;;;wCAEyB;AACxB,WAAKC,mBAAL,CAAyBC,UAAzB;AACA,UAAI,KAAKZ,WAAT,EAAsB;AACpB,aAAKA,WAAL,CAAiBa,KAAjB;AACD;AACD,WAAKZ,YAAL,GAAoB,IAApB;AACD;;;8BAEe;AACd,WAAKa,MAAL,CAAYC,KAAZ,CAAkB,SAAlB;AACA,WAAKC,SAAL;AACA,WAAKC,YAAL,CAAkBC,OAAlB;AACD;;;+BAEgB;AACf,WAAKlB,WAAL,CAAiBmB,MAAjB;AACD;;;8BAEe;AACd,WAAKnB,WAAL,CAAiBoB,KAAjB;AACD;;;gCAEoB;AACnB,aAAO,KAAKlB,UAAZ;AACD;;;mCAEoB;AACnB,WAAKe,YAAL,CAAkBI,MAAlB,CAAyB,KAAKvB,MAA9B,EAAsC,KAAKA,MAAL,CAAYwB,KAAZ,CAAkBC,eAAxD,EAAyE,KAAKC,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B,CAAzE;AACA,WAAKR,YAAL,CAAkBI,MAAlB,CAAyB,KAAKvB,MAA9B,EAAsC,KAAKA,MAAL,CAAYwB,KAAZ,CAAkBI,WAAxD,EAAqE,KAAKC,kBAAL,CAAwBF,IAAxB,CAA6B,IAA7B,CAArE;AACA,WAAKR,YAAL,CAAkBI,MAAlB,CAAyB,KAAKvB,MAA9B,EAAsC,KAAKA,MAAL,CAAYwB,KAAZ,CAAkBM,OAAxD,EAAiE,KAAKC,eAAL,CAAqBJ,IAArB,CAA0B,IAA1B,CAAjE;AACA,WAAKR,YAAL,CAAkBI,MAAlB,CAAyB,KAAKvB,MAA9B,EAAsC,KAAKA,MAAL,CAAYwB,KAAZ,CAAkBQ,MAAxD,EAAgE,KAAKC,cAAL,CAAoBN,IAApB,CAAyB,IAAzB,CAAhE;AACA,WAAKR,YAAL,CAAkBI,MAAlB,CAAyB,KAAKvB,MAA9B,EAAsC,KAAKA,MAAL,CAAYwB,KAAZ,CAAkBU,KAAxD,EAA+D,KAAKC,aAAL,CAAmBR,IAAnB,CAAwB,IAAxB,CAA/D;AACD;;;4BAEa;AAAA;;AACZ,WAAKnC,cAAL,GAAsB,IAAI4C,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrD,YAAIC,cAAeC,OAAOC,MAAP,IAAiBD,OAAOC,MAAP,CAAcC,GAAhC,GAAuCN,QAAQC,OAAR,EAAvC,GAA2D,OAAKM,QAAL,EAA7E;AACAJ,oBAAY9C,IAAZ,CAAiB,YAAM;AACrB,iBAAKmD,IAAL,GAAYJ,OAAOC,MAAP,CAAcC,GAA1B;AACA,cAAI,OAAKG,iBAAL,EAAJ,EAA8B;AAC5B,mBAAKC,cAAL;AACA,mBAAKC,WAAL;AACAV;AACD,WAJD,MAIO;AACLC;AACD;AACF,SATD;AAUD,OAZqB,CAAtB;AAaD;;;wCAE4B;AAC3B,WAAKtB,MAAL,CAAYC,KAAZ,CAAkB,oBAAlB;AACA,UAAI+B,kBAAkBC,SAASC,cAAT,CAAwB,aAAxB,CAAtB;AACA,UAAIC,eAAe,KAAKnD,MAAL,CAAYoD,eAAZ,EAAnB;AACA,UAAID,YAAJ,EAAkB;AAChB,YAAI,CAACH,eAAL,EAAsB;AACpB,cAAIG,aAAaE,UAAjB,EAA6B;AAC3B,iBAAKC,eAAL,GAAuBH,aAAaE,UAAb,CAAwBE,WAAxB,CAAoCN,SAASO,aAAT,CAAuB,KAAvB,CAApC,CAAvB;AACA,iBAAKF,eAAL,CAAqBG,EAArB,GAA0B,aAA1B;AACA,iBAAKH,eAAL,CAAqBI,KAArB,CAA2BC,QAA3B,GAAsC,UAAtC;AACA,iBAAKL,eAAL,CAAqBI,KAArB,CAA2BE,MAA3B,GAAoC,MAApC;AACA,iBAAKN,eAAL,CAAqBI,KAArB,CAA2BG,GAA3B,GAAiC,GAAjC;AACD,WAND,MAMO;AACL,mBAAO,KAAP;AACD;AACF,SAVD,MAUO;AACL,eAAKP,eAAL,GAAuBN,eAAvB;AACD;AACD,aAAKnC,mBAAL,GAA2B,IAAI,KAAK+B,IAAL,CAAUkB,kBAAd,CAAiC,KAAKR,eAAtC,EAAuDH,YAAvD,CAA3B;AACA,aAAKtC,mBAAL,CAAyBC,UAAzB;AACA,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;;;qCAEsB;AACrB,WAAKE,MAAL,CAAYC,KAAZ,CAAkB,iBAAlB;AACA,WAAK8C,UAAL,GAAkB,IAAI,KAAKnB,IAAL,CAAUoB,SAAd,CAAwB,KAAKnD,mBAA7B,CAAlB;AACA,WAAKkD,UAAL,CAAgBE,gBAAhB,CAAiC,KAAKrB,IAAL,CAAUsB,qBAAV,CAAgCC,IAAhC,CAAqCC,kBAAtE,EAA0F,KAAKC,mBAAL,CAAyB1C,IAAzB,CAA8B,IAA9B,CAA1F;AACA,WAAKoC,UAAL,CAAgBE,gBAAhB,CAAiC,KAAKrB,IAAL,CAAU0B,YAAV,CAAuBH,IAAvB,CAA4BI,QAA7D,EAAuE,KAAKC,UAAL,CAAgB7C,IAAhB,CAAqB,IAArB,CAAvE;AACD;;;kCAEsB;AACrB,WAAKX,MAAL,CAAYC,KAAZ,CAAkB,aAAlB;AACA,WAAKC,SAAL;AACA,UAAIuD,aAAa,IAAI,KAAK7B,IAAL,CAAU8B,UAAd,EAAjB;AACA,UAAI,KAAKzE,MAAL,CAAY0E,QAAhB,EAA0B;AACxBF,mBAAWE,QAAX,GAAsB,KAAK1E,MAAL,CAAY0E,QAAlC;AACD,OAFD,MAEO;AACLF,mBAAWG,WAAX,GAAyB,KAAK3E,MAAL,CAAY2E,WAArC;AACD;AACD,UAAI,CAACH,WAAWE,QAAZ,IAAwB,CAACF,WAAWG,WAAxC,EAAqD;AACnD,aAAK5D,MAAL,CAAY6D,KAAZ,CAAkB,+BAAlB;AACA,eAAO,KAAP;AACD;AACD;AACA,WAAKd,UAAL,CAAgBe,UAAhB,CAA2BL,UAA3B;AACA,aAAO,IAAP;AACD;;;wCAEyB;AACxB,WAAKnE,uBAAL,CAA6BI,QAA7B,GAAwC,KAAKV,MAAL,CAAYU,QAApD;AACD;;;yCAE0B;AACzB,UAAI,CAAC,KAAKJ,uBAAL,CAA6BG,OAAlC,EAA2C;AACzC,aAAKH,uBAAL,CAA6BE,YAA7B,GAA4C,KAAKF,uBAAL,CAA6BC,WAAzE;AACA,aAAKD,uBAAL,CAA6BC,WAA7B,GAA2C,KAAKP,MAAL,CAAYO,WAAvD;AACD;AACF;;;sCAEuB;AACtB,WAAKD,uBAAL,CAA6BG,OAA7B,GAAuC,IAAvC;AACD;;;qCAEsB;AACrB,WAAKH,uBAAL,CAA6BG,OAA7B,GAAuC,KAAvC;AACD;;;oCAEqB;AACpB,UAAI,KAAKsD,UAAL,IAAmB,CAAC,KAAK1D,gBAA7B,EAA+C;AAC7C,aAAK0D,UAAL,CAAgBgB,eAAhB;AACA,aAAK1E,gBAAL,GAAwB,IAAxB;AACD;AACF;;;wCAEyB;AACxB,WAAKiD,eAAL,CAAqBI,KAArB,CAA2BsB,OAA3B,GAAqC,EAArC;AACD;;;wCAEyB;AACxB,WAAK1B,eAAL,CAAqBI,KAArB,CAA2BsB,OAA3B,GAAqC,MAArC;AACD;;;wCAEmBC,qB,EAAkC;AACpD,WAAKjE,MAAL,CAAYC,KAAZ,CAAkB,oBAAlB;AACA,UAAIiE,uBAAuB,IAAI,KAAKtC,IAAL,CAAUuC,oBAAd,EAA3B;AACAD,2BAAqBE,2CAArB,GAAmE,IAAnE;AACA,WAAKlF,WAAL,GAAmB+E,sBAAsBI,aAAtB,CAAoC,KAAK/E,uBAAzC,EAAkE4E,oBAAlE,CAAnB;AACA,WAAKI,kBAAL;AACD;;;yCAE0B;AACzB;AACA,WAAKpF,WAAL,CAAiB+D,gBAAjB,CAAkC,KAAKrB,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuBqB,uBAAzD,EAAkF,KAAKC,wBAAL,CAA8B9D,IAA9B,CAAmC,IAAnC,CAAlF;AACA,WAAKzB,WAAL,CAAiB+D,gBAAjB,CAAkC,KAAKrB,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuBuB,wBAAzD,EAAmF,KAAKC,yBAAL,CAA+BhE,IAA/B,CAAoC,IAApC,CAAnF;AACA;AACA,WAAKzB,WAAL,CAAiB+D,gBAAjB,CAAkC,KAAKrB,IAAL,CAAU0B,YAAV,CAAuBH,IAAvB,CAA4BI,QAA9D,EAAwE,KAAKC,UAAL,CAAgB7C,IAAhB,CAAqB,IAArB,CAAxE;AACA,UAAIiE,SAAS,CACX,KAAKhD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB0B,iBADZ,EAEX,KAAKjD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB2B,KAFZ,EAGX,KAAKlD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB4B,QAHZ,EAIX,KAAKnD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB6B,cAJZ,EAKX,KAAKpD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB8B,MALZ,EAMX,KAAKrD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB+B,QANZ,EAOX,KAAKtD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuBgC,MAPZ,EAQX,KAAKvD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuBiC,OARZ,EASX,KAAKxD,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuBkC,cATZ,CAAb;AANyB;AAAA;AAAA;;AAAA;AAiBzB,6BAAkBT,MAAlB,8HAA0B;AAAA,cAAjBU,KAAiB;;AACxB,eAAKpG,WAAL,CAAiB+D,gBAAjB,CAAkCqC,KAAlC,EAAyC,KAAKC,UAAL,CAAgB5E,IAAhB,CAAqB,IAArB,CAAzC;AACD;AAnBwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAoBzB,UAAI6E,gBAAgB,KAAKxG,MAAL,CAAYoD,eAAZ,EAApB;AACA,UAAIoD,aAAJ,EAAmB;AACjB,YAAIC,YAAYC,SAASC,iBAAiBH,aAAjB,EAAgCI,KAAzC,EAAgD,EAAhD,CAAhB;AACA,YAAIC,aAAaH,SAASC,iBAAiBH,aAAjB,EAAgCM,MAAzC,EAAiD,EAAjD,CAAjB;AACA;AACA,aAAK5G,WAAL,CAAiB6G,IAAjB,CAAsBN,SAAtB,EAAiCI,UAAjC,EAA6C,KAAKjE,IAAL,CAAUoE,QAAV,CAAmBC,MAAhE;AACA,aAAK/G,WAAL,CAAiBa,KAAjB;AACD;AACF;;;6CAEwBmG,O,EAAoB;AAC3C,WAAKlG,MAAL,CAAYC,KAAZ,CAAkB,gBAAgBiG,QAAQC,IAAR,CAAaC,WAAb,EAAlC;AACA,WAAKC,iBAAL;AACA,WAAKrH,MAAL,CAAYsB,KAAZ;AACA,WAAKlB,UAAL,GAAkB,IAAlB;AACD;;;8CAEyB8G,O,EAAoB;AAC5C,WAAKlG,MAAL,CAAYC,KAAZ,CAAkB,gBAAgBiG,QAAQC,IAAR,CAAaC,WAAb,EAAlC;AACA,UAAI,CAAC,KAAK/G,gBAAV,EAA4B;AAC1B,aAAKiH,iBAAL;AACA,aAAKtH,MAAL,CAAYuH,IAAZ;AACA,aAAKnH,UAAL,GAAkB,KAAlB;AACD;AACF;;;+BAEUoH,M,EAAc;AACvB,WAAKxG,MAAL,CAAY6D,KAAZ,CAAkB2C,MAAlB;AACD;;;+BAEUN,O,EAAoB;AAC7B,WAAKlG,MAAL,CAAYC,KAAZ,CAAkB,gBAAgBiG,QAAQC,IAAR,CAAaC,WAAb,EAAlC;AACA,cAAQF,QAAQC,IAAhB;AACE,aAAK,KAAKvE,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB0B,iBAA5B;AACE,eAAK4B,iBAAL,CAAuBP,OAAvB;AACA;AACF,aAAK,KAAKtE,IAAL,CAAU2C,OAAV,CAAkBpB,IAAlB,CAAuB2B,KAA5B;AACE,eAAK4B,YAAL,CAAkBR,OAAlB;AACA;AACF;AACE;AARJ;AAUD;;;sCAEiBA,O,EAAoB;AACpC,WAAKlG,MAAL,CAAYC,KAAZ,CAAkB,kBAAlB,EAAsCiG,OAAtC;AACA,WAAKI,iBAAL;AACA,WAAKK,gBAAL,GAAwB,IAAxB;AACD;;;iCAEYT,O,EAAoB;AAC/B,WAAKhH,WAAL,CAAiBoB,KAAjB;AACD;;;gCAEiB;AAChB,WAAKlB,UAAL,GAAkB,KAAlB;AACA,WAAKkH,iBAAL;AACA,UAAI,KAAKpH,WAAT,EAAsB;AACpB,aAAKA,WAAL,CAAiBkB,OAAjB;AACA,aAAKlB,WAAL,GAAmB,IAAnB;AACD;AACD,UAAI,KAAK6D,UAAL,IAAmB,CAAC,KAAK1D,gBAA7B,EAA+C;AAC7C,aAAK0D,UAAL,CAAgBgB,eAAhB;AACD;AACD,WAAK1E,gBAAL,GAAwB,KAAxB;AACA,WAAKsH,gBAAL,GAAwB,KAAxB;AACD;;;+BAEsB;AAAA;;AACrB,aAAO,IAAIvF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAIsF,IAAI,KAAR;AAAA,YACEC,IAAI5E,SAAS6E,oBAAT,CAA8B,QAA9B,EAAwC,CAAxC,CADN;AAAA,YAEEC,IAAI9E,SAASO,aAAT,CAAuB,QAAvB,CAFN;AAGAuE,UAAEZ,IAAF,GAAS,iBAAT;AACAY,UAAEC,GAAF,GAAQ,OAAK/H,MAAL,CAAYgB,KAAZ,GAAoBnB,IAAImI,qBAAxB,GAAgDnI,IAAIoI,eAA5D;AACAH,UAAEI,KAAF,GAAU,IAAV;AACAJ,UAAEK,MAAF,GAAWL,EAAEM,kBAAF,GAAuB,YAAY;AAC5C,cAAI,CAACT,CAAD,KAAO,CAAC,KAAKU,UAAN,IAAoB,KAAKA,UAAL,KAAoB,UAA/C,CAAJ,EAAgE;AAC9DV,gBAAI,IAAJ;AACAvF,oBAAQ,IAAR;AACD;AACF,SALD;AAMA0F,UAAEQ,OAAF,GAAYR,EAAES,OAAF,GAAYlG,MAAxB;AACA,YAAIuF,KAAKA,EAAExE,UAAX,EAAuB;AACrBwE,YAAExE,UAAF,CAAaoF,YAAb,CAA0BV,CAA1B,EAA6BF,CAA7B;AACD;AACF,OAjBM,CAAP;AAkBD;;;;;;AA3SG/H,G,CAEG4I,a,GAAwB;AAC7BzH,SAAO,KADsB;AAE7B0H,WAAS,IAFoB;AAG7BC,kBAAgB,GAHa;AAI7BC,WAAS,eAJoB;AAK7BC,wBAAsB;AALO,C;AAF3BhJ,G,CAUGoI,e,GAA0B,8C;AAV7BpI,G,CAWGmI,qB,GAAgC,oD;;;AAmSzC,+BAAepI,UAAf,EAA2BC,GAA3B,E","file":"playkit-ima.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"playkit-js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"playkit-js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PlaykitJsIma\"] = factory(require(\"playkit-js\"));\n\telse\n\t\troot[\"PlaykitJsIma\"] = factory(root[\"Playkit\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a5b85016c5944be87979","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":\"Playkit\"}\n// module id = 0\n// module chunks = 0","// @flow\n// import {PlayerMiddlewareBase} from '../node_modules/playkit-js/src/playkit.js'\nimport {PlayerMiddlewareBase} from 'playkit-js'\n\nlet context: any;\n\nexport default class ImaMiddleware extends PlayerMiddlewareBase {\n  constructor(pluginContext: any) {\n    super();\n    context = pluginContext;\n  }\n\n  play(next: Function): void {\n    context.initImaPromise.then(() => {\n      // if (!context.initComplete) {\n      //   context.initialUserAction();\n      // } else {\n        if (context.adsActive()) {\n          context.resumeAd();\n        } else {\n          super.play(next);\n        }\n      // }\n    });\n  }\n\n  pause(next: Function): void {\n    if (context.adsActive()) {\n      context.pauseAd();\n    } else {\n      super.pause(next);\n    }\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./ima-middleware.js","// @flow\n// import {registerPlugin, BasePlugin} from '../node_modules/playkit-js/src/playkit.js'\nimport {registerPlugin, BasePlugin} from 'playkit-js'\nimport ImaMiddleware from './ima-middleware'\n// import {PlayerMiddlewareBase} from '../node_modules/playkit-js/src/playkit.js'\nimport {PlayerMiddlewareBase} from 'playkit-js'\n\nconst pluginName = \"ima\";\n\nclass Ima extends BasePlugin {\n\n  static defaultConfig: Object = {\n    debug: false,\n    timeout: 5000,\n    prerollTimeout: 100,\n    adLabel: 'Advertisement',\n    showControlsForJSAds: true\n  };\n\n  static IMA_SDK_LIB_URL: string = \"//imasdk.googleapis.com/js/sdkloader/ima3.js\";\n  static IMA_SDK_DEBUG_LIB_URL: string = \"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js\";\n\n  initImaPromise: Promise<*>;\n  initComplete: boolean;\n  _adsActive: boolean;\n  _adsManager: any;\n\n  _sdk: any;\n  _adContainerDiv: HTMLDivElement;\n  _contentComplete: boolean;\n  _adDisplayContainer: any;\n  _adsLoader: any;\n  _allAdsCompleted: boolean;\n  _contentPlayheadTracker: Object;\n\n  static isValid() {\n    return true;\n  }\n\n  constructor(name: string, player: Player, config: Object) {\n    super(name, player, config);\n    this._adsManager = null;\n    this.initComplete = false;\n    this._adsActive = false;\n    this._contentComplete = false;\n    this._contentPlayheadTracker = {\n      currentTime: 0,\n      previousTime: 0,\n      seeking: false,\n      duration: 0\n    };\n    this._addBindings();\n    this._init();\n  }\n\n  getPlayerMiddleware(): PlayerMiddlewareBase {\n    return new ImaMiddleware(this);\n  }\n\n  initialUserAction(): void {\n    this._adDisplayContainer.initialize();\n    if (this._adsManager) {\n      this._adsManager.start();\n    }\n    this.initComplete = true;\n  }\n\n  destroy(): void {\n    this.logger.debug(\"destroy\");\n    this._resetIma();\n    this.eventManager.destroy();\n  }\n\n  resumeAd(): void {\n    this._adsManager.resume();\n  }\n\n  pauseAd(): void {\n    this._adsManager.pause();\n  }\n\n  adsActive(): boolean {\n    return this._adsActive;\n  }\n\n  _addBindings(): void {\n    this.eventManager.listen(this.player, this.player.Event.LOADED_METADATA, this._onLoadedMetadata.bind(this));\n    this.eventManager.listen(this.player, this.player.Event.TIME_UPDATE, this._onMediaTimeUpdate.bind(this));\n    this.eventManager.listen(this.player, this.player.Event.SEEKING, this._onMediaSeeking.bind(this));\n    this.eventManager.listen(this.player, this.player.Event.SEEKED, this._onMediaSeeked.bind(this));\n    this.eventManager.listen(this.player, this.player.Event.ENDED, this._onMediaEnded.bind(this));\n  }\n\n  _init(): void {\n    this.initImaPromise = new Promise((resolve, reject) => {\n      let loadPromise = (window.google && window.google.ima) ? Promise.resolve() : this._loadIma();\n      loadPromise.then(() => {\n        this._sdk = window.google.ima;\n        if (this._initAdsContainer()) {\n          this._initAdsLoader();\n          this._requestAds();\n          resolve();\n        } else {\n          reject();\n        }\n      });\n    });\n  }\n\n  _initAdsContainer(): boolean {\n    this.logger.debug(\"Init ads container\");\n    let adsContainerDiv = document.getElementById(\"adContainer\");\n    let videoElement = this.player.getVideoElement();\n    if (videoElement) {\n      if (!adsContainerDiv) {\n        if (videoElement.parentNode) {\n          this._adContainerDiv = videoElement.parentNode.appendChild(document.createElement('div'));\n          this._adContainerDiv.id = \"adContainer\";\n          this._adContainerDiv.style.position = \"absolute\";\n          this._adContainerDiv.style.zIndex = \"2000\";\n          this._adContainerDiv.style.top = \"0\";\n        } else {\n          return false;\n        }\n      } else {\n        this._adContainerDiv = adsContainerDiv;\n      }\n      this._adDisplayContainer = new this._sdk.AdDisplayContainer(this._adContainerDiv, videoElement);\n      this._adDisplayContainer.initialize();\n      return true;\n    }\n    return false;\n  }\n\n  _initAdsLoader(): void {\n    this.logger.debug(\"Init ads loader\");\n    this._adsLoader = new this._sdk.AdsLoader(this._adDisplayContainer);\n    this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, this._onAdsManagerLoaded.bind(this));\n    this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, this._onAdError.bind(this));\n  }\n\n  _requestAds(): boolean {\n    this.logger.debug(\"Request ads\");\n    this._resetIma();\n    let adsRequest = new this._sdk.AdsRequest();\n    if (this.config.adTagUrl) {\n      adsRequest.adTagUrl = this.config.adTagUrl;\n    } else {\n      adsRequest.adsResponse = this.config.adsResponse;\n    }\n    if (!adsRequest.adTagUrl && !adsRequest.adsResponse) {\n      this.logger.error(\"missing config for ima plugin\");\n      return false;\n    }\n    //TODO: Handle non-linear\n    this._adsLoader.requestAds(adsRequest);\n    return true;\n  }\n\n  _onLoadedMetadata(): void {\n    this._contentPlayheadTracker.duration = this.player.duration;\n  }\n\n  _onMediaTimeUpdate(): void {\n    if (!this._contentPlayheadTracker.seeking) {\n      this._contentPlayheadTracker.previousTime = this._contentPlayheadTracker.currentTime;\n      this._contentPlayheadTracker.currentTime = this.player.currentTime;\n    }\n  }\n\n  _onMediaSeeking(): void {\n    this._contentPlayheadTracker.seeking = true;\n  }\n\n  _onMediaSeeked(): void {\n    this._contentPlayheadTracker.seeking = false;\n  }\n\n  _onMediaEnded(): void {\n    if (this._adsLoader && !this._contentComplete) {\n      this._adsLoader.contentComplete();\n      this._contentComplete = true;\n    }\n  }\n\n  _showAdsContainer(): void {\n    this._adContainerDiv.style.display = \"\";\n  }\n\n  _hideAdsContainer(): void {\n    this._adContainerDiv.style.display = \"none\";\n  }\n\n  _onAdsManagerLoaded(adsManagerLoadedEvent: any): void {\n    this.logger.debug('Ads manager loaded');\n    let adsRenderingSettings = new this._sdk.AdsRenderingSettings();\n    adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete = true;\n    this._adsManager = adsManagerLoadedEvent.getAdsManager(this._contentPlayheadTracker, adsRenderingSettings);\n    this._processAdsManager();\n  }\n\n  _processAdsManager(): void {\n    // Attach the pause/resume events\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED, this._onContentPauseRequested.bind(this));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED, this._onContentResumeRequested.bind(this));\n    // Handle errors\n    this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, this._onAdError.bind(this));\n    let events = [\n      this._sdk.AdEvent.Type.ALL_ADS_COMPLETED,\n      this._sdk.AdEvent.Type.CLICK,\n      this._sdk.AdEvent.Type.COMPLETE,\n      this._sdk.AdEvent.Type.FIRST_QUARTILE,\n      this._sdk.AdEvent.Type.LOADED,\n      this._sdk.AdEvent.Type.MIDPOINT,\n      this._sdk.AdEvent.Type.PAUSED,\n      this._sdk.AdEvent.Type.STARTED,\n      this._sdk.AdEvent.Type.THIRD_QUARTILE\n    ];\n    for (let index of events) {\n      this._adsManager.addEventListener(index, this._onAdEvent.bind(this));\n    }\n    let playerElement = this.player.getVideoElement();\n    if (playerElement) {\n      let initWidth = parseInt(getComputedStyle(playerElement).width, 10);\n      let initHeight = parseInt(getComputedStyle(playerElement).height, 10);\n      // TODO: Handle full screen\n      this._adsManager.init(initWidth, initHeight, this._sdk.ViewMode.NORMAL);\n      this._adsManager.start();\n    }\n  }\n\n  _onContentPauseRequested(adEvent: any): void {\n    this.logger.debug(\"onAdEvent: \" + adEvent.type.toUpperCase());\n    this._showAdsContainer();\n    this.player.pause();\n    this._adsActive = true;\n  }\n\n  _onContentResumeRequested(adEvent: any): void {\n    this.logger.debug(\"onAdEvent: \" + adEvent.type.toUpperCase());\n    if (!this._contentComplete) {\n      this._hideAdsContainer();\n      this.player.play();\n      this._adsActive = false;\n    }\n  }\n\n  _onAdError(params): void {\n    this.logger.error(params);\n  }\n\n  _onAdEvent(adEvent: any): void {\n    this.logger.debug(\"onAdEvent: \" + adEvent.type.toUpperCase());\n    switch (adEvent.type) {\n      case this._sdk.AdEvent.Type.ALL_ADS_COMPLETED:\n        this._onAllAdsComplete(adEvent);\n        break;\n      case this._sdk.AdEvent.Type.CLICK:\n        this._onAdClicked(adEvent);\n        break;\n      default:\n        break;\n    }\n  }\n\n  _onAllAdsComplete(adEvent: any): void {\n    this.logger.debug(\"onAllAdsComplete\", adEvent);\n    this._hideAdsContainer();\n    this._allAdsCompleted = true;\n  }\n\n  _onAdClicked(adEvent: any): void {\n    this._adsManager.pause();\n  }\n\n  _resetIma(): void {\n    this._adsActive = false;\n    this._hideAdsContainer();\n    if (this._adsManager) {\n      this._adsManager.destroy();\n      this._adsManager = null;\n    }\n    if (this._adsLoader && !this._contentComplete) {\n      this._adsLoader.contentComplete();\n    }\n    this._contentComplete = false;\n    this._allAdsCompleted = false;\n  }\n\n  _loadIma(): Promise<*> {\n    return new Promise((resolve, reject) => {\n      let r = false,\n        t = document.getElementsByTagName(\"script\")[0],\n        s = document.createElement(\"script\");\n      s.type = \"text/javascript\";\n      s.src = this.config.debug ? Ima.IMA_SDK_DEBUG_LIB_URL : Ima.IMA_SDK_LIB_URL;\n      s.async = true;\n      s.onload = s.onreadystatechange = function () {\n        if (!r && (!this.readyState || this.readyState === \"complete\")) {\n          r = true;\n          resolve(this);\n        }\n      };\n      s.onerror = s.onabort = reject;\n      if (t && t.parentNode) {\n        t.parentNode.insertBefore(s, t);\n      }\n    });\n  }\n}\n\nregisterPlugin(pluginName, Ima);\n\n\n\n// WEBPACK FOOTER //\n// ./ima.js"],"sourceRoot":""}