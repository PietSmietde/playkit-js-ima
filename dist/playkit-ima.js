!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@playkit-js/playkit-js")):"function"==typeof define&&define.amd?define("ima",["playkit-js"],t):"object"==typeof exports?exports.ima=t(require("@playkit-js/playkit-js")):(e.KalturaPlayer=e.KalturaPlayer||{},e.KalturaPlayer.plugins=e.KalturaPlayer.plugins||{},e.KalturaPlayer.plugins.ima=t(e.KalturaPlayer.core))}(this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Ima=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(4),d=n(5),l=n(6),c=n(2),u=n(0);n(9);var h=n(14),f=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange"],p=function(e){function t(e,n,r){i(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return s._stateMachine=new l.ImaStateMachine(s),s._initMembers(),s._init(),s}return r(t,e),s(t,null,[{key:"isValid",value:function(){return!0}}]),s(t,[{key:"getEngineDecorator",value:function(e){return new h.ImaEngineDecorator(e,this)}},{key:"getMiddlewareImpl",value:function(){return new o.ImaMiddleware(this)}},{key:"getAdsController",value:function(){return new d.ImaAdsController(this)}},{key:"playAdNow",value:function(e){!Array.isArray(e)||this.isAdPlaying()||this._playAdByConfig()||this._playAdBreak(e)}},{key:"_playAdBreak",value:function(e){var t=this;this._podLength=e.length,this._adPosition=1,this._firstOfAdPod=!0,this.loadPromise.then(function(){return t._playAd(e)})}},{key:"_playAd",value:function(e){var t=this,n=e.shift(),i=function(){t._adBreaksEventManager.removeAll(),t._firstOfAdPod=!1,t._podLength=e.length,t._adPosition++,t._playAd(e)};n&&(this._adBreaksEventManager.listen(this._adsLoader,this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(){t._adBreaksEventManager.listen(t._adsManager,t._sdk.AdEvent.Type.COMPLETE,i),t._adBreaksEventManager.listen(t._adsManager,t._sdk.AdEvent.Type.SKIPPED,i),t._adBreaksEventManager.listen(t._adsManager,t._sdk.AdEvent.Type.LOG,i),t._adBreaksEventManager.listen(t._adsManager,t._sdk.AdErrorEvent.Type.AD_ERROR,i)}),this._adBreaksEventManager.listen(this._adsLoader,this._sdk.AdErrorEvent.Type.AD_ERROR,function(){i(),0===t._podLength&&(t._stateMachine.adbreakend({type:t._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED}),t._stateMachine.adscompleted({type:t._sdk.AdEvent.Type.ALL_ADS_COMPLETED}),t.player.ended||t.player.play())}),this._requestAds(n.url[0]))}},{key:"skipAd",value:function(){this.logger.debug("Skip ad"),this._adsManager&&(this._adsManager.getAdSkippableState()?this._adsManager.skip():this.config.skipSupport&&this._adsManager.stop())}},{key:"resumeAd",value:function(){return this.logger.debug("Resume ad"),this._nextPromise=u.Utils.Object.defer(),this._adsManager.resume(),this._nextPromise}},{key:"pauseAd",value:function(){this.logger.debug("Pause ad"),this._adsManager.pause()}},{key:"getStateMachine",value:function(){return this._stateMachine}},{key:"playOnMainVideoTag",value:function(){return!!this._adsManager&&!!this._adsManager.isCustomPlaybackUsed()}},{key:"isAdPlaying",value:function(){return this._stateMachine.is(c.State.PLAYING)||this._stateMachine.is(c.State.PENDING)||this._stateMachine.is(c.State.PAUSED)}},{key:"getContentTime",value:function(){var e=0;return this._videoLastCurrentTime?e=this._videoLastCurrentTime:this._contentComplete&&(e=this.getContentDuration()),e}},{key:"getContentDuration",value:function(){return this._contentDuration||this.player.config.sources.duration||0}},{key:"getContentSrc",value:function(){return this._contentSrc||""}},{key:"getContentEnded",value:function(){return this._contentComplete}},{key:"loadMedia",value:function(){var e=this;this._addBindings(),this._playAdByConfig()&&this.loadPromise.then(function(){return e._requestAds()})}},{key:"reset",value:function(){this.logger.debug("reset"),this.eventManager.removeAll(),this._adBreaksEventManager.removeAll(),this._hideAdsContainer(),this._isImaSDKLibLoaded()&&(this._adsManager&&this._adsManager.destroy(),this._adsLoader&&!this._contentComplete&&this._adsLoader.contentComplete(),this._stateMachine.goto(c.State.DONE),this._initMembers())}},{key:"destroy",value:function(){this.logger.debug("destroy"),this.eventManager.destroy(),this._hideAdsContainer(),this._adsManager&&this._adsManager.destroy(),this._adsLoader&&!this._contentComplete&&this._adsLoader.contentComplete(),this._adsLoader=null}},{key:"initialUserAction",value:function(){try{this.logger.debug("Initial user action"),this._nextPromise=u.Utils.Object.defer(),this._adDisplayContainer.initialize(),this._hasUserAction=!0,this._isAdsManagerLoaded&&(this.logger.debug("User action occurred after ads manager loaded"),this._startAdsManager())}catch(e){this.logger.error(e),this.reset()}return this._nextPromise}},{key:"_startAdsManager",value:function(){var e=this;this.logger.debug("Start ads manager"),(this.playOnMainVideoTag()&&!this.config.disableMediaPreload?this.player.ready():Promise.resolve()).then(function(){e._adsManager.init(e.player.dimensions.width,e.player.dimensions.height,e._sdk.ViewMode.NORMAL),e._adsManager.start()})}},{key:"_addBindings",value:function(){var e=this;f.forEach(function(t){return e.eventManager.listen(document,t,function(){return e._resizeAd()})}),this.eventManager.listen(this.player,"resize",function(){return e._resizeAd()}),this.eventManager.listen(this.player,this.player.Event.MUTE_CHANGE,function(){return e._syncPlayerVolume()}),this.eventManager.listen(this.player,this.player.Event.VOLUME_CHANGE,function(){return e._syncPlayerVolume()}),this.eventManager.listen(this.player,this.player.Event.SOURCE_SELECTED,function(t){var n=t.payload.selectedSource;n&&n.length>0&&(e._contentSrc=n[0].url)}),this.eventManager.listenOnce(this.player,this.player.Event.DURATION_CHANGE,function(){e._contentDuration=e.player.duration}),this.eventManager.listen(this.player,this.player.Event.ERROR,function(t){t.payload&&t.payload.severity===u.Error.Severity.CRITICAL&&e.reset()}),this.eventManager.listen(this.player,this.player.Event.FIRST_PLAY,function(){e._currentAd&&!e._currentAd.isLinear()&&e._showAdsContainer()}),this.eventManager.listen(this.player,this.player.Event.MEDIA_LOADED,function(){e._adsManager.updateAdsRenderingSettings({restoreCustomPlaybackStateOnAdBreakComplete:!e.player.config.playback.playAdsWithMSE})}),this.eventManager.listen(this.player,this.player.Event.ENDED,function(){return e._onMediaEnded()}),this.eventManager.listen(this.player,this.player.Event.LOADED_METADATA,function(){return e._onLoadedMetadata()}),this.eventManager.listen(this.player,this.player.Event.TIME_UPDATE,function(){return e._onMediaTimeUpdate()}),this.eventManager.listen(this.player,this.player.Event.SEEKING,function(){return e._onMediaSeeking()}),this.eventManager.listen(this.player,this.player.Event.SEEKED,function(){return e._onMediaSeeked()})}},{key:"_initMembers",value:function(){this._nextPromise=null,this._currentAd=null,this._adsManager=null,this._contentComplete=!1,this._isAdsManagerLoaded=!1,this._videoLastCurrentTime=null,this._contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this._hasUserAction=!1,this._togglePlayPauseOnAdsContainerCallback=null,this._contentDuration=null,this._selectedAudioTrack=null,this._selectedTextTrack=null,this._selectedPlaybackRate=1,this._textTracksHidden=[],this._adBreaksEventManager=new u.EventManager,this._podLength=0,this._adPosition=0,this._firstOfAdPod=!1}},{key:"_init",value:function(){var e=this;this.loadPromise=u.Utils.Object.defer(),this._maybeDelayInitUntilSourceSelected().then(function(){return e._loadImaSDKLib()}).then(function(){e._sdk=window.google.ima,e.logger.debug("IMA SDK version: "+e._sdk.VERSION),e._initImaSettings(),e._initAdsContainer(),e._initAdsLoader(),e.loadPromise.resolve()}).catch(function(t){e.loadPromise.reject(t)})}},{key:"_maybeDelayInitUntilSourceSelected",value:function(){var e=this;return this.config.delayInitUntilSourceSelected?new Promise(function(t,n){e._contentSrc?t():(e.eventManager.listenOnce(e.player,e.player.Event.SOURCE_SELECTED,t),e.eventManager.listenOnce(e.player,e.player.Event.ERROR,n))}):Promise.resolve()}},{key:"_loadImaSDKLib",value:function(){var e=u.Utils.Http.protocol+(this.config.debug?t.IMA_SDK_DEBUG_LIB_URL:t.IMA_SDK_LIB_URL);return this._isImaSDKLibLoaded()?Promise.resolve():u.Utils.Dom.loadScriptAsync(e)}},{key:"_isImaSDKLibLoaded",value:function(){return window.google&&window.google.ima&&window.google.ima.VERSION}},{key:"_initImaSettings",value:function(){this._sdk.settings.setPlayerType(this.config.playerName),this._sdk.settings.setPlayerVersion(this.config.playerVersion),this._sdk.settings.setVpaidAllowed(!0),this._sdk.settings.setVpaidMode(this._getVpaidMode()),this.config.hasOwnProperty("locale")&&this._sdk.settings.setLocale(this.config.locale),"boolean"==typeof this.config.setDisableCustomPlaybackForIOS10Plus?this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.config.setDisableCustomPlaybackForIOS10Plus):this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playback.playsinline),"number"==typeof this.config.numRedirects&&this._sdk.settings.setNumRedirects(this.config.numRedirects)}},{key:"_getVpaidMode",value:function(){var e=this._sdk.ImaSdkSettings.VpaidMode[this.config.vpaidMode];return this.config.vpaidMode&&"number"==typeof e?(this.logger.debug("VpaidMode: set to "+this.config.vpaidMode),e):(this.logger.warn("VpaidMode is not set, setting to ENABLED"),this._sdk.ImaSdkSettings.VpaidMode.ENABLED)}},{key:"_initAdsContainer",value:function(){var e=this;this.logger.debug("Init ads container");var t=this.player.getView();this._adsContainerDiv=u.Utils.Dom.createElement("div"),this._adsContainerDiv.id="playkit-ads-container"+t.id,this._adsContainerDiv.className="playkit-ads-container",this._adsCoverDiv=u.Utils.Dom.createElement("div"),this._adsCoverDiv.id="playkit-ads-cover"+t.id,this._adsCoverDiv.className="playkit-ads-cover",this._adsCoverDiv.onclick=function(){return e._onAdsCoverClicked()},u.Utils.Dom.appendChild(t,this._adsContainerDiv),this._adDisplayContainer=new this._sdk.AdDisplayContainer(this._adsContainerDiv,this.player.getVideoElement())}},{key:"_initAdsLoader",value:function(){var e=this;this.logger.debug("Init ads loader"),this._adsLoader=new this._sdk.AdsLoader(this._adDisplayContainer),this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){return e._onAdsManagerLoaded(t)}),this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(t){return e._stateMachine.aderror(t)})}},{key:"_requestAds",value:function(e){var t=this;if(e||this._playAdByConfig()){this.logger.debug("Request ads");var n=new this._sdk.AdsRequest,i=e||this.config.adTagUrl;i?n.adTagUrl=i:n.adsResponse=this.config.adsResponse,"number"==typeof this.config.vastLoadTimeout&&(n.vastLoadTimeout=this.config.vastLoadTimeout),n.linearAdSlotWidth=this.player.dimensions.width,n.linearAdSlotHeight=this.player.dimensions.height,n.nonLinearAdSlotWidth=this.player.dimensions.width,n.nonLinearAdSlotHeight=this.player.dimensions.height/3;var a=this.player.muted||0===this.player.volume;n.setAdWillPlayMuted(a);var r=this.config.adWillAutoPlay,s=u.Utils.Object.getPropertyPath(this.player.config,"playback.autoplay"),o=u.Utils.Object.getPropertyPath(this.player.config,"playback.allowMutedAutoPlay"),d=u.Utils.Object.getPropertyPath(this.player.config,"playback.playsinline");"boolean"==typeof r?(n.setAdWillAutoPlay(r),this._adsLoader.requestAds(n)):s?(0,u.getCapabilities)(u.EngineType.HTML5,d).then(function(e){t._adsLoader&&(e.autoplay?n.setAdWillAutoPlay(!0):o&&e.mutedAutoPlay?(n.setAdWillAutoPlay(!0),n.setAdWillPlayMuted(!0)):n.setAdWillAutoPlay(!1),t._adsLoader.requestAds(n))}):(n.setAdWillAutoPlay(!1),this._adsLoader.requestAds(n)),this._stateMachine.loaded()}else this._stateMachine.goto(c.State.DONE),this.logger.debug("Missing ad tag url: create plugin without requesting ads")}},{key:"_resizeAd",value:function(){if(this._sdk&&this._adsManager&&this._currentAd){var e=this.player.isFullscreen()?this._sdk.ViewMode.FULLSCREEN:this._sdk.ViewMode.NORMAL;this._currentAd.isLinear()?this._adsManager.resize(this.player.dimensions.width,this.player.dimensions.height,e):(this._alignAdsContainerSizeForOverlayAd(),this._adsManager.resize(this._currentAd.getWidth()+8,this._currentAd.getHeight()+8,e))}}},{key:"_alignAdsContainerSizeForOverlayAd",value:function(){this._adsContainerDiv.style.bottom=this._currentAd.getHeight()+8+"px",this._adsContainerDiv.style.left=(this.player.dimensions.width-this._currentAd.getWidth())/2+"px"}},{key:"_onLoadedMetadata",value:function(){this._contentPlayheadTracker.duration=this.player.duration}},{key:"_onMediaTimeUpdate",value:function(){!this._contentPlayheadTracker.seeking&&this.player.currentTime>0&&(this._contentPlayheadTracker.previousTime=this._contentPlayheadTracker.currentTime,this._contentPlayheadTracker.currentTime=this.player.currentTime)}},{key:"_onMediaSeeking",value:function(){this._contentPlayheadTracker.seeking=!0}},{key:"_onMediaSeeked",value:function(){this._contentPlayheadTracker.seeking=!1}},{key:"_maybeSaveVideoCurrentTime",value:function(){(this.playOnMainVideoTag()||this.config.forceReloadMediaAfterAds)&&this.player.currentTime&&this.player.currentTime>0&&(this.logger.debug("Custom playback used: save current time before ads",this.player.currentTime),this._videoLastCurrentTime=this.player.currentTime)}},{key:"_maybeSetVideoCurrentTime",value:function(){this._videoLastCurrentTime&&(this.logger.debug("Custom playback used: set current time after ads",this._videoLastCurrentTime),this.player.currentTime=this._videoLastCurrentTime,this._videoLastCurrentTime=null)}},{key:"_onMediaEnded",value:function(){this.logger.debug("Media ended"),this._contentComplete=!0,this._currentAd&&!this._currentAd.isLinear()&&this.reset()}},{key:"onPlaybackEnded",value:function(){var e=this;return this.logger.debug("Playback ended"),this._adsLoader.contentComplete(),this._adsManager&&this._adsManager.getCuePoints().includes(-1)?new Promise(function(t){e.eventManager.listenOnce(e._adsManager,e._sdk.AdEvent.Type.ALL_ADS_COMPLETED,function(){t()})}):Promise.resolve()}},{key:"_showAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.visibility="visible")}},{key:"_hideAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.visibility="hidden")}},{key:"_onAdsManagerLoaded",value:function(e){this.logger.debug("Ads manager loaded");var t=this._getAdsRenderingSetting();this._adsManager=e.getAdsManager(this._contentPlayheadTracker,t),this.config.forceReloadMediaAfterAds=!this.playOnMainVideoTag()&&this.config.forceReloadMediaAfterAds;var n=this._adsManager.getCuePoints();n.length||n.push(0),this._playAdByConfig()&&this.dispatchEvent(this.player.Event.AD_MANIFEST_LOADED,{adBreaksPosition:n}),this._isAdsManagerLoaded=!0,this._attachAdsManagerListeners(),this._syncPlayerVolume(),this._hasUserAction&&(this.logger.debug("User action occurred before ads manager loaded"),this._startAdsManager())}},{key:"_getAdsRenderingSetting",value:function(){var e=this,t=new this._sdk.AdsRenderingSettings;return Object.keys(this.config.adsRenderingSettings).forEach(function(n){void 0!==t[n]?t[n]=e.config.adsRenderingSettings[n]:e.logger.warn("unsupported adsRenderingSettings was set:",n)}),t.restoreCustomPlaybackStateOnAdBreakComplete=!1,"number"!=typeof this.config.adsRenderingSettings.playAdsAfterTime&&(t.playAdsAfterTime=this.player.config.playback.startTime),t}},{key:"_attachAdsManagerListeners",value:function(){var e=this;this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(t){(e._playAdByConfig()||e._firstOfAdPod)&&e._stateMachine.adbreakstart(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(t){(e._playAdByConfig()||0===e._podLength)&&e._stateMachine.adbreakend(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.ALL_ADS_COMPLETED,function(t){(e._playAdByConfig()||0===e._podLength)&&e._stateMachine.adscompleted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOADED,function(t){return e._stateMachine.adloaded(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.STARTED,function(t){return e._stateMachine.adstarted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.PAUSED,function(t){return e._stateMachine.adpaused(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.RESUMED,function(t){return e._stateMachine.adresumed(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.FIRST_QUARTILE,function(t){return e._stateMachine.adfirstquartile(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.MIDPOINT,function(t){return e._stateMachine.admidpoint(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.THIRD_QUARTILE,function(t){return e._stateMachine.adthirdquartile(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CLICK,function(t){return e._stateMachine.adclicked(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPED,function(t){return e._stateMachine.adskipped(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.COMPLETE,function(t){return e._stateMachine.adcompleted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.USER_CLOSE,function(t){return e._stateMachine.userclosedad(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_CHANGED,function(t){return e._stateMachine.advolumechanged(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_MUTED,function(t){return e._stateMachine.admuted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_PROGRESS,function(t){return e._stateMachine.adprogress(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_BUFFERING,function(t){return e._stateMachine.adbuffering(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOG,function(t){return e._stateMachine.aderror(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(t){return e._stateMachine.adcanskip(t)}),this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(t){return e._stateMachine.aderror(t)})}},{key:"_syncPlayerVolume",value:function(){this._adsManager&&(this.player.muted?this._adsManager.setVolume(0):this._adsManager&&!isNaN(this.player.volume)&&"number"==typeof this.player.volume&&this._adsManager.setVolume(this.player.volume))}},{key:"_resolveNextPromise",value:function(){this._nextPromise&&(this._nextPromise.resolve(),this._nextPromise=null)}},{key:"_setToggleAdsCover",value:function(e){e?this.playOnMainVideoTag()||this._adsContainerDiv.parentNode&&(this._adsContainerDiv.parentNode.insertBefore(this._adsCoverDiv,this._adsContainerDiv.nextSibling),this._isAdsCoverActive=!0):this._isAdsCoverActive&&this._adsContainerDiv.parentNode&&(this._adsContainerDiv.parentNode.removeChild(this._adsCoverDiv),this._isAdsCoverActive=!1)}},{key:"_onAdsCoverClicked",value:function(){if(this._adsManager)switch(this._stateMachine.state){case c.State.PAUSED:this._adsManager.resume();break;case c.State.PLAYING:this._adsManager.pause()}}},{key:"_maybeDisplayCompanionAds",value:function(){if(this.config.companions&&this.config.companions.ads&&!window.googletag){var e=new this._sdk.CompanionAdSelectionSettings;e.resourceType=this._sdk.CompanionAdSelectionSettings.ResourceType.ALL,e.creativeType=this._sdk.CompanionAdSelectionSettings.CreativeType.ALL;var t=this.config.companions.sizeCriteria;e.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria[t]||this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH;for(var n=Object.keys(this.config.companions.ads),i=0;i<n.length;i++){var a=n[i],r=this.config.companions.ads[a],s=r.width,o=r.height;try{var d=this._currentAd.getCompanionAds(s,o,e);if(d.length>0){var l=d[0],c=l.getContent(),h=u.Utils.Dom.getElementById(a);h&&(h.innerHTML=c)}}catch(e){this.logger.error("Error occurred while extracting companion ad",e)}}}}},{key:"_maybeIgnoreClickOnAd",value:function(){var e=this;(function(){return"Android"===e.player.env.os.name})()&&function(){return"Chrome"===e.player.env.browser.name}()&&this.eventManager.listenOnce(this.player.getView(),"click",function(e){return e.stopPropagation()})}},{key:"_hideActiveTextTracksOnAVPlayer",value:function(){var e=this;if("iOS"===this.player.env.os.name&&this.playOnMainVideoTag()){var t=this.player.getVideoElement().textTracks;Array.from(t).forEach(function(t){"showing"===t.mode&&Array.from(t.activeCues).forEach(function(t){e._textTracksHidden.push(t.text),t.text=""})})}}},{key:"_setActiveTextTracksOnAVPlayer",value:function(){var e=this,t="iOS"===this.player.env.os.name;if(this._textTracksHidden&&t&&this.playOnMainVideoTag()){var n=this.player.getVideoElement().textTracks;Array.from(n).forEach(function(t){"showing"===t&&Array.from(t.activeCues).forEach(function(t){e._textTracksHidden.length>0&&(t.text=e._textTracksHidden.shift())})})}this._textTracksHidden=[]}},{key:"_maybeForceExitFullScreen",value:function(){"iOS"===this.player.env.os.name&&!this.playOnMainVideoTag()&&this.player.isFullscreen()&&!this.player.config.playback.inBrowserFullscreen&&this.player.config.playback.playsinline&&this.player.exitFullscreen()}},{key:"_playAdByConfig",value:function(){return!(!this.config.adTagUrl&&!this.config.adsResponse)}}]),t}(u.BasePlugin);p.defaultConfig={debug:!1,delayInitUntilSourceSelected:"iOS"===u.Env.os.name,disableMediaPreload:!1,forceReloadMediaAfterAds:!1,adsRenderingSettings:{restoreCustomPlaybackStateOnAdBreakComplete:!1,enablePreloading:!1,useStyledLinearAds:!1,useStyledNonLinearAds:!0,bitrate:-1,autoAlign:!0,loadVideoTimeout:-1},companions:{ads:null,sizeCriteria:"SELECT_EXACT_MATCH"}},p.IMA_SDK_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3.js",p.IMA_SDK_DEBUG_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3_debug.js",t.Ima=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={LOADING:"loading",LOADED:"loaded",PENDING:"pending",PLAYING:"playing",PAUSED:"paused",IDLE:"idle",DONE:"done"};t.State=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAME=t.VERSION=t.Plugin=void 0;var i=n(0),a=n(1);t.Plugin=a.Ima,t.VERSION="0.18.2",t.NAME="@playkit-js/playkit-js-ima";(0,i.registerPlugin)("ima",a.Ima)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImaMiddleware=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(0),d=(n(1),n(2)),l=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.id="ImaMiddleware",n._context=e,e.player.addEventListener(e.player.Event.CHANGE_SOURCE_STARTED,function(){n._isFirstPlay=!0,n._nextLoad=null}),n}return r(t,e),s(t,[{key:"load",value:function(e){var t=this;this._nextLoad=e,this._context.config.adTagUrl||this._context.config.adsResponse?(this._context.player.addEventListener(this._context.player.Event.AD_ERROR,function(){t._callNextLoad()}),this._context.player.addEventListener(this._context.player.Event.AD_MANIFEST_LOADED,function(e){e.payload.adBreaksPosition.includes(0)||t._callNextLoad()})):this._callNextLoad()}},{key:"play",value:function(e){var t=this;this._isFirstPlay&&(this._isFirstPlay=!1,this._context.config.disableMediaPreload?this._context.player.getVideoElement().load():this._callNextLoad()),this._context.loadPromise.then(function(){switch(t._context.getStateMachine().state){case d.State.PLAYING:break;case d.State.LOADED:var n=t._context.initialUserAction();if(n)return n.then(function(){t.callNext(e)});t.callNext(e);break;case d.State.PAUSED:var i=t._context.resumeAd();if(i)return i.then(function(){t.callNext(e)});t.callNext(e);break;default:t.callNext(e)}}).catch(function(n){t._context.reset(),t._context.logger.error(n),t.callNext(e)})}},{key:"pause",value:function(e){switch(this._context.getStateMachine().state){case d.State.PAUSED:break;case d.State.PLAYING:this._context.pauseAd();break;default:this.callNext(e)}}},{key:"_callNextLoad",value:function(){!this._nextLoad||this._context.playOnMainVideoTag()||this._context.config.disableMediaPreload||this.callNext(this._nextLoad),this._nextLoad=null}}]),t}(o.BaseMiddleware);t.ImaMiddleware=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ImaAdsController=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=(n(1),n(2)),s=function(){function e(t){i(this,e),this._context=t}return a(e,[{key:"skipAd",value:function(){this._context.skipAd()}},{key:"playAdNow",value:function(e){this._context.playAdNow(e)}},{key:"onPlaybackEnded",value:function(){return this._context.onPlaybackEnded()}},{key:"active",get:function(){return this._context.getStateMachine().state===r.State.PLAYING||this._context.getStateMachine().state===r.State.PAUSED}},{key:"done",get:function(){return this._context.getStateMachine().state===r.State.DONE}},{key:"name",get:function(){return this._context.name}}]),e}();t.ImaAdsController=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){this.logger.debug(t.type.toUpperCase()),this.playOnMainVideoTag()&&(this._selectedAudioTrack=this.player.getActiveTracks().audio,this._selectedTextTrack=this.player.getActiveTracks().text,this._selectedPlaybackRate=this.player.playbackRate,this._hideActiveTextTracksOnAVPlayer(),this.player.hideTextTrack());var n=k.call(this,t),i=E.call(this,t),a=new O.Ad(t.getAd().getAdId(),i);O.Utils.Dom.setAttribute(this._adsContainerDiv,"data-adtype",n),this.logger.warn("adType and extraAdData fields will be deprecated soon from AD_LOADED event payload. See docs for more information"),this.dispatchEvent(e.transition,{ad:a,adType:n,extraAdData:t.getAdData()})}function s(e,t){this.logger.debug(t.type.toUpperCase()),this._currentAd=t.getAd(),this._resizeAd(),this._maybeDisplayCompanionAds(),this._currentAd.isLinear()?this._showAdsContainer():this._nextPromise?this._resolveNextPromise():this.player.play();var n=E.call(this,t),i=new O.Ad(t.getAd().getAdId(),n);this.dispatchEvent(e.transition,{ad:i})}function o(e,t){this.logger.debug(t.type.toUpperCase()),this._currentAd.isLinear()?(this._maybeIgnoreClickOnAd(),this._stateMachine.is(C.State.PLAYING)&&this._adsManager.pause(),this._setToggleAdsCover(!0)):this.player.paused||this.player.pause(),this.dispatchEvent(e.transition)}function d(e,t){this.logger.debug(t.type.toUpperCase()),this._setToggleAdsCover(!1),this.dispatchEvent(e.transition)}function l(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition)}function c(e,t){this.logger.debug(e.transition.toUpperCase()),this.playOnMainVideoTag()&&this._contentComplete&&!this.player.config.playback.playAdsWithMSE&&(this.player.getVideoElement().src=this._contentSrc),h.call(this,e,t)}function u(e,t){this.logger.debug(t.type.toUpperCase()),this.player.pause();var n=b.call(this,t),i=new O.AdBreak(n);this._maybeForceExitFullScreen(),this._maybeSaveVideoCurrentTime(),this.dispatchEvent(e.transition,{adBreak:i})}function h(e,t){var n=this;this.logger.debug(t.type.toUpperCase()),this._currentAd=null,this._contentComplete||(this.config.forceReloadMediaAfterAds&&(this.eventManager.listenOnce(this.player,this.player.Event.LOADED_DATA,function(){n._maybeSetVideoCurrentTime(),n.player.play()}),this.player.getVideoElement().load()),this._hideAdsContainer(),this._maybeSetVideoCurrentTime(),this._nextPromise?this._resolveNextPromise():this.config.forceReloadMediaAfterAds||this.player.play()),this.playOnMainVideoTag()&&this.eventManager.listenOnce(this.player,this.player.Event.CAN_PLAY,function(){n.player.selectTrack(n._selectedAudioTrack),n.player.selectTrack(n._selectedTextTrack),n.player.playbackRate=n._selectedPlaybackRate,n._setActiveTextTracksOnAVPlayer()}),this.dispatchEvent(e.transition)}function f(e,t){var n=this;if("adError"===t.type&&this._playAdByConfig()){this.logger.debug(t.type.toUpperCase());var i=t.getError();this._nextPromise?this.playOnMainVideoTag()&&"iOS"!==this.player.env.os.name?setTimeout(function(){n._nextPromise.reject(i)},0,i):this._nextPromise.reject(i):this.reset(),this.dispatchEvent(e.transition,m.call(this,i,!0))}else{this.logger.debug(t.type.toUpperCase());var a=void 0;"function"==typeof t.getAdData?a=t.getAdData().adError:"function"==typeof t.getError&&(a=t.getError()),a&&(this.logger.error("Non-fatal error occurred: "+a.getMessage()),this.dispatchEvent(this.player.Event.AD_ERROR,m.call(this,a,!1)))}}function p(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition)}function g(e,t){this.logger.debug(t.type.toUpperCase()),this._adsManager.getAdSkippableState()&&this.dispatchEvent(e.transition)}function y(e,t){this.logger.debug(t.type.toUpperCase());var n=this._adsManager.getRemainingTime(),i=t.getAdData()&&t.getAdData().duration,a=i-n;O.Utils.Number.isNumber(i)&&O.Utils.Number.isNumber(a)&&this.dispatchEvent(e.transition,{adProgress:{currentTime:a,duration:i}})}function _(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition)}function v(e){e.from!==e.to&&this.logger.debug("Change state: "+e.from+" => "+e.to)}function A(e,t,n){this.logger.warn("The previous transition is still in progress",{transition:e,from:t,to:n})}function m(e,t){var n=t?O.Error.Severity.CRITICAL:O.Error.Severity.RECOVERABLE,i=O.Error.Category.ADS,a=void 0;try{a=900!==e.getVastErrorCode()?parseInt(O.Error.Category.ADS+e.getVastErrorCode()):O.Error.Code.AD_UNDEFINED_ERROR}catch(e){a=O.Error.Code.AD_UNDEFINED_ERROR}var r=void 0;if(this._adsManager)try{var s=this._adsManager.getCurrentAd(),o={getAd:function(){return s},getAdData:function(){}},d=E.call(this,o);r=new O.Ad(s.getAdId(),d)}catch(e){}return new O.Error(n,i,a,{ad:r,innerError:e})}function E(e){var t={},n=e.getAd(),i=e.getAdData(),a=n.getAdPodInfo();return t.system=n.getAdSystem(),t.url=n.getMediaUrl(),t.clickThroughUrl=i&&i.clickThroughUrl,t.contentType=n.getContentType(),t.duration=n.getDuration(),t.position=this._adPosition||a.getAdPosition(),t.title=n.getTitle(),t.linear=n.isLinear(),t.skipOffset=n.getSkipTimeOffset(),t.width=n.isLinear()?n.getVastMediaWidth():n.getWidth(),t.height=n.isLinear()?n.getVastMediaHeight():n.getHeight(),t.bitrate=n.getVastMediaBitrate(),t.bumper=a.getIsBumper(),t}function b(e){var t={};return t.numAds=this._podLength||e.getAd().getAdPodInfo().getTotalAds(),t.position=this.player.ended?-1:this.player.currentTime,t.type=k.call(this,e),t}function k(e){return e.getAd().isLinear()?this._playAdByConfig()?S(e):M.call(this):O.AdBreakType.OVERLAY}function S(e){var t=e.getAd(),n=t.getAdPodInfo(),i=n.getPodIndex();if(!t.isLinear())return O.AdBreakType.OVERLAY;switch(i){case 0:return O.AdBreakType.PRE;case-1:return O.AdBreakType.POST;default:return O.AdBreakType.MID}}function M(){return this.player.ended?O.AdBreakType.POST:this.player.currentTime>0?O.AdBreakType.MID:O.AdBreakType.PRE}Object.defineProperty(t,"__esModule",{value:!0}),t.ImaStateMachine=void 0;var T=n(7),L=i(T),D=n(8),P=i(D),C=n(2),O=n(0),I=function e(t){return a(this,e),new L.default({init:C.State.LOADING,transitions:[{name:"loaded",from:[C.State.LOADING,C.State.LOADED,C.State.IDLE,C.State.PAUSED,C.State.PLAYING,C.State.DONE],to:C.State.LOADED},{name:t.player.Event.AD_STARTED,from:[C.State.LOADED,C.State.IDLE,C.State.PAUSED,C.State.PLAYING,C.State.PENDING],to:function(e){return e.getAd().isLinear()?C.State.PLAYING:C.State.IDLE}},{name:t.player.Event.AD_RESUMED,from:[C.State.PAUSED,C.State.PLAYING],to:C.State.PLAYING},{name:t.player.Event.AD_PAUSED,from:C.State.PLAYING,to:C.State.PAUSED},{name:t.player.Event.AD_SKIPPED,from:[C.State.PLAYING,C.State.PAUSED],to:C.State.IDLE},{name:t.player.Event.AD_COMPLETED,from:[C.State.PLAYING,C.State.PAUSED]},{name:t.player.Event.ADS_COMPLETED,from:[C.State.IDLE,C.State.PAUSED],to:C.State.DONE},{name:t.player.Event.AD_BREAK_END,from:[C.State.IDLE,C.State.PLAYING,C.State.LOADED,C.State.PAUSED],to:C.State.IDLE},{name:t.player.Event.AD_ERROR,from:[C.State.IDLE,C.State.LOADED,C.State.PLAYING,C.State.PAUSED,C.State.LOADING,C.State.PENDING],to:C.State.IDLE},{name:t.player.Event.AD_LOADED,from:[C.State.IDLE,C.State.LOADED,C.State.PLAYING]},{name:t.player.Event.AD_FIRST_QUARTILE,from:C.State.PLAYING},{name:t.player.Event.AD_BREAK_START,from:[C.State.IDLE,C.State.LOADED],to:C.State.PENDING},{name:t.player.Event.AD_MIDPOINT,from:C.State.PLAYING},{name:t.player.Event.AD_THIRD_QUARTILE,from:C.State.PLAYING},{name:t.player.Event.USER_CLOSED_AD,from:[C.State.IDLE,C.State.PLAYING,C.State.PAUSED]},{name:t.player.Event.AD_VOLUME_CHANGED,from:[C.State.PLAYING,C.State.PAUSED,C.State.LOADED]},{name:t.player.Event.AD_MUTED,from:[C.State.PLAYING,C.State.PAUSED,C.State.LOADED]},{name:t.player.Event.AD_CLICKED,from:[C.State.PLAYING,C.State.PAUSED,C.State.IDLE]},{name:t.player.Event.AD_CAN_SKIP,from:[C.State.PLAYING,C.State.PAUSED,C.State.LOADED]},{name:t.player.Event.AD_PROGRESS,from:[C.State.PLAYING,C.State.PAUSED]},{name:t.player.Event.AD_BUFFERING,from:"*"},{name:"goto",from:"*",to:function(e){return e}}],methods:{onAdloaded:r.bind(t),onAdstarted:s.bind(t),onAdpaused:_.bind(t),onAdresumed:d.bind(t),onAdclicked:o.bind(t),onAdskipped:p.bind(t),onAdcompleted:l.bind(t),onAdscompleted:c.bind(t),onAdcanskip:g.bind(t),onAdbreakstart:u.bind(t),onAdbreakend:h.bind(t),onAdfirstquartile:_.bind(t),onAdmidpoint:_.bind(t),onAdthirdquartile:_.bind(t),onAderror:f.bind(t),onUserclosedad:_.bind(t),onAdvolumechanged:_.bind(t),onAdmuted:_.bind(t),onAdprogress:y.bind(t),onAdbuffering:_.bind(t),onEnterState:v.bind(t),onPendingTransition:A.bind(t)},plugins:[new P.default]})};t.ImaStateMachine=I},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,i,a;for(n=1;n<arguments.length;n++){i=arguments[n];for(a in i)i.hasOwnProperty(a)&&(e[a]=i[a])}return e}},function(e,t,n){"use strict";var i=n(0);e.exports={build:function(e,t){var n,a,r,s=t.plugins;for(n=0,a=s.length;n<a;n++)r=s[n],r.methods&&i(e,r.methods),r.properties&&Object.defineProperties(e,r.properties)},hook:function(e,t,n){var i,a,r,s,o=e.config.plugins,d=[e.context];for(n&&(d=d.concat(n)),i=0,a=o.length;i<a;i++)s=o[i],(r=o[i][t])&&r.apply(s,d)}}},function(e,t,n){"use strict";function i(e){if(0===e.length)return e;var t,n,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(n=i[0].toLowerCase(),t=1;t<i.length;t++)n=n+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return n}i.prepended=function(e,t){return t=i(t),e+t[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,n){"use strict";function i(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}var a=n(0),r=n(2);a(i.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=r.prepended("onEnter",e),this.lifecycle.onLeave[e]=r.prepended("onLeave",e),this.lifecycle.on[e]=r.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=r.prepended("onBefore",e),this.lifecycle.onAfter[e]=r.prepended("onAfter",e),this.lifecycle.on[e]=r.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,i=e.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(a({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(a({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){e=e||[];var n,i,a;for(n=0,i=e.length;n<i;n++)a=e[n],"function"==typeof a&&(e[n]=a=a()),a.configure&&a.configure(this);return e},configureTransitions:function(e){var t,n,i,a,r,s=this.defaults.wildcard;for(n=0;n<e.length;n++)for(i=e[n],a=Array.isArray(i.from)?i.from:[i.from||s],r=i.to||s,t=0;t<a.length;t++)this.mapTransition({name:i.name,from:a[t],to:r})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=i},function(e,t,n){function i(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}var a=n(0),r=n(6),s=n(1),o=[null,[]];a(i.prototype,{init:function(e){if(a(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,e),a=i&&i.to;return"function"==typeof a?a.apply(this.context,t):a===n?this.state:a},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,i){var a=this.config.lifecycle,r=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(a.onBefore.transition),this.observersForEvent(a.onBefore[e]),r?this.observersForEvent(a.onLeave.state):o,r?this.observersForEvent(a.onLeave[t]):o,this.observersForEvent(a.on.transition),r?["doTransit",[this]]:o,r?this.observersForEvent(a.onEnter.state):o,r?this.observersForEvent(a.onEnter[n]):o,r?this.observersForEvent(a.on[n]):o,this.observersForEvent(a.onAfter.transition),this.observersForEvent(a.onAfter[e]),this.observersForEvent(a.on[e])],i)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,i=this.observers.length,a=[];n<i;n++)t=this.observers[n],t[e]&&a.push(t);return[e,a,!0]},observeEvents:function(e,t,n,i){if(0===e.length)return this.endTransit(void 0===i||i);var a=e[0][0],r=e[0][1],o=e[0][2];if(t[0].event=a,a&&o&&a!==n&&s.hook(this,"lifecycle",t),0===r.length){var d=e.slice(1);return this.observeEvents(d,t,a,i)}var l=r.shift(),c=l[a].apply(l,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,a)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,a,c)},onInvalidTransition:function(e,t,n){throw new r("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new r("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=i},function(e,t,n){"use strict";function i(e){return r(this||{},e)}function a(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new c(t,i);return s(e.prototype,n),e.prototype._fsm.config=n,e}function r(e,t){return s(e,new c(t,i)),e._fsm(),e}function s(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");l.build(e,t),Object.defineProperties(e,f),o(e,h),o(e,t.methods),t.allTransitions().forEach(function(t){e[d(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new u(this,t),this._fsm.init(arguments)}}var o=n(0),d=n(2),l=n(1),c=n(3),u=n(4),h={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},f={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};i.version="3.0.1",i.factory=a,i.apply=r,i.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e,t,n,i,a){this.message=e,this.transition=t,this.from=n,this.to=i,this.current=a}}])})},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function i(e){if(0===e.length)return e;var t,n,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(n=i[0].toLowerCase(),t=1;t<i.length;t++)n=n+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return n}i.prepended=function(e,t){return t=i(t),e+t[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,n){"use strict";var i=n(0);e.exports=function(e){e=e||{};var t=i(e.name||e.past||"history"),n=i(e.future||"future"),a=i.prepended("clear",t),r=i.prepended(t,"back"),s=i.prepended(t,"forward"),o=i.prepended("can",r),d=i.prepended("can",s),l=e.max,c={configure:function(e){e.addTransitionLifecycleNames(r),e.addTransitionLifecycleNames(s)},init:function(e){e[t]=[],e[n]=[]},lifecycle:function(e,i){"onEnterState"===i.event&&(e[t].push(i.to),l&&e[t].length>l&&e[t].shift(),i.transition!==r&&i.transition!==s&&(e[n].length=0))},methods:{},properties:{}};return c.methods[a]=function(){this[t].length=0,this[n].length=0},c.properties[o]={get:function(){return this[t].length>1}},c.properties[d]={get:function(){return this[n].length>0}},c.methods[r]=function(){if(!this[o])throw Error("no history");var e=this[t].pop(),i=this[t].pop();this[n].push(e),this._fsm.transit(r,e,i,[])},c.methods[s]=function(){if(!this[d])throw Error("no history");var e=this.state,t=this[n].pop();this._fsm.transit(s,e,t,[])},c}}])})},function(e,t,n){var i=n(10);"string"==typeof i&&(i=[[e.i,i,""]]);var a={};a.transform=void 0;n(12)(i,a);i.locals&&(e.exports=i.locals)},function(e,t,n){t=e.exports=n(11)(void 0),t.push([e.i,".playkit-ads-cover {\n  position: relative;\n  cursor: pointer;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0);\n}\n\n.playkit-ads-container {\n  visibility: hidden;\n  position: absolute;\n}\n",""])},function(e,t){function n(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var r=i(a);return[n].concat(a.sources.map(function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"})).concat([r]).join("\n")}return[n].join("\n")}function i(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=n(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},a=0;a<this.length;a++){var r=this[a][0];"number"==typeof r&&(i[r]=!0)}for(a=0;a<e.length;a++){var s=e[a];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},function(e,t,n){function i(e,t){for(var n=0;n<e.length;n++){var i=e[n],a=p[i.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](i.parts[r]);for(;r<i.parts.length;r++)a.parts.push(c(i.parts[r],t))}else{for(var s=[],r=0;r<i.parts.length;r++)s.push(c(i.parts[r],t));p[i.id]={id:i.id,refs:1,parts:s}}}}function a(e,t){for(var n=[],i={},a=0;a<e.length;a++){var r=e[a],s=t.base?r[0]+t.base:r[0],o=r[1],d=r[2],l=r[3],c={css:o,media:d,sourceMap:l};i[s]?i[s].parts.push(c):n.push(i[s]={id:s,parts:[c]})}return n}function r(e,t){var n=y(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=A[A.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),A.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function s(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=A.indexOf(e);t>=0&&A.splice(t,1)}function o(e){var t=document.createElement("style");return e.attrs.type="text/css",l(t,e.attrs),r(e,t),t}function d(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",l(t,e.attrs),r(e,t),t}function l(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function c(e,t){var n,i,a,r;if(t.transform&&e.css){if(!(r=t.transform(e.css)))return function(){};e.css=r}if(t.singleton){var l=v++;n=_||(_=o(t)),i=u.bind(null,n,l,!1),a=u.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=d(t),i=f.bind(null,n,t),a=function(){s(n),n.href&&URL.revokeObjectURL(n.href)}):(n=o(t),i=h.bind(null,n),a=function(){s(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}function u(e,t,n,i){var a=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=E(t,a);else{var r=document.createTextNode(a),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function h(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function f(e,t,n){var i=n.css,a=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&a;(t.convertToAbsoluteUrls||r)&&(i=m(i)),a&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var s=new Blob([i],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(s),o&&URL.revokeObjectURL(o)}var p={},g=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),y=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e.call(this,n)),t[n]}}(function(e){return document.querySelector(e)}),_=null,v=0,A=[],m=n(13);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=g()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=a(e,t);return i(n,t),function(e){for(var r=[],s=0;s<n.length;s++){var o=n[s],d=p[o.id];d.refs--,r.push(d)}if(e){i(a(e,t),t)}for(var s=0;s<r.length;s++){var d=r[s];if(0===d.refs){for(var l=0;l<d.parts.length;l++)d.parts[l]();delete p[d.id]}}}};var E=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(a))return e;var r;return r=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:i+a.replace(/^\.\//,""),"url("+JSON.stringify(r)+")"})}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ImaEngineDecorator=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=(n(0),n(1),function(){function e(t,n){i(this,e),this._plugin=n}return a(e,[{key:"dispatchEvent",value:function(e){return e.defaultPrevented}},{key:"active",get:function(){return this._plugin.playOnMainVideoTag()&&this._plugin.isAdPlaying()}},{key:"paused",get:function(){return!0}},{key:"currentTime",get:function(){return this._plugin.getContentTime()},set:function(e){}},{key:"duration",get:function(){return this._plugin.getContentDuration()}},{key:"ended",get:function(){return this._plugin.getContentEnded()}}]),e}());t.ImaEngineDecorator=r}])});
//# sourceMappingURL=playkit-ima.js.map